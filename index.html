<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Lotus Collections -- Indian Luxury Clothing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Indian luxury clothing — sarees, lehengas, sherwanis and more. Enquire to purchase." />
  <link rel="icon" type="image/png" href="assets/images/logo.png" />
  <!-- Single-file preview for Canvas. In your real project, split CSS/JS into separate files as before. -->
  <style>
    :root{
      --bg: #130b0d;            /* deep plum */
      --bg-2: #1b1013;          /* card base */
      --text: #f7f4ef;          /* ivory */
      --muted: #cdbba7;         /* muted sand */
      --accent: #cfa23a;        /* antique gold */
      --accent-2:#895f1a;       /* darker gold for focus/active */
      --ring: rgba(207,162,58,.4);

      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --hairline: 1px solid rgba(207,162,58,.35);
      --container: 1100px;
      --step-0: clamp(14px, .9vw, 16px);
      --step-1: clamp(18px, 1.2vw, 22px);
      --step-2: clamp(24px, 2vw, 34px);
      --step-3: clamp(32px, 3vw, 48px);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font: 400 var(--step-0)/1.55 ui-serif, Georgia, "Times New Roman", serif;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 120% -10%, rgba(207,162,58,.06), transparent 60%),
        radial-gradient(1000px 500px at -20% 110%, rgba(207,162,58,.08), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg-2));
    }

    .visually-hidden{ position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }

    .container{ width:min(92%, var(--container)); margin-inline:auto; }

    .site-header{ position:sticky; top:0; backdrop-filter: blur(6px); background: rgba(19,11,13,.6); border-bottom: var(--hairline); z-index: 20; }
    .header-inner{ display:flex; align-items:center; justify-content:space-between; padding: 14px 0; }
    .brand{ display:flex; gap:.6rem; align-items:center; text-decoration:none; color:var(--text); font-weight:700; letter-spacing:.5px; }
    .brand-mark{ display:inline-grid; place-items:center; width:34px; height:34px; border-radius:50%; border:1px solid rgba(207,162,58,.5); }
    .brand-text{ font-size: 20px; }

    .nav{ list-style:none; display:flex; gap:1.1rem; margin:0; padding:0; }
    .nav a{ color:var(--muted); text-decoration:none; }
    .nav a:hover, .nav a.active{ color:var(--text); }

    .hero{ padding: 64px 0 24px; text-align:center; }
    .hero-inner h1{ font-size: var(--step-3); margin:0 0 .4rem; letter-spacing: .4px; }
    .hero-inner p{ color:var(--muted); margin:0 auto; max-width: 56ch; }

    .filters{ padding: 8px 0 18px; }
    .filter-row{ display:flex; gap:.6rem; flex-wrap:wrap; }
    .chip{
      appearance:none; border: var(--hairline); background: transparent; color: var(--muted);
      padding: .45rem .8rem; border-radius: 999px; cursor:pointer;
    }
    .chip:hover{ color:var(--text); border-color: var(--accent); }
    .chip--active{ color:var(--text); background: rgba(207,162,58,.12); border-color: var(--accent); }

    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 18px;
      padding-bottom: 48px;
    }
    .card{
      grid-column: span 12;
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));
      border: var(--hairline);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: var(--shadow);
      transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
    }
    .card:hover{ transform: translateY(-4px); border-color: var(--accent); box-shadow: 0 16px 40px rgba(0,0,0,.45); }

    .card-body{ padding: 14px 14px 16px; display:grid; gap:6px; }
    .card-title{ margin:0; font-size: var(--step-1); letter-spacing:.2px; }
    .card-meta{ color:var(--muted); font-size: .95em; }
    .card-cta{ margin-top: 8px; display:flex; justify-content: space-between; align-items:center; gap:.5rem; }
    .btn, .link{
      display:inline-flex; align-items:center; justify-content:center;
      border-radius: 999px; text-decoration:none; cursor:pointer;
    }
    .btn{ padding:.55rem .9rem; border:1px solid var(--accent); background: rgba(207,162,58,.12); color: var(--text); }
    .btn:hover{ background: rgba(207,162,58,.18); }
    .btn:focus-visible{ outline: 3px solid var(--ring); outline-offset: 2px; }
    .link{ color: var(--muted); }
    .link:hover{ color: var(--text); }

    @media (min-width: 700px){ .card{ grid-column: span 6; } }
    @media (min-width: 1024px){ .card{ grid-column: span 4; } }

    .site-footer{ border-top: var(--hairline); margin-top: 18px; }
    .footer-inner{ padding: 18px 0 24px; color: var(--muted); font-size: .95em; display:flex; flex-direction:column; gap:6px; align-items:center; text-align:center; }

    /* Contact layout */
    .contact-layout{ display:grid; gap:18px; padding: 28px 0 48px; grid-template-columns: 1fr; }
    .contact-product, .contact-form-card{ border: var(--hairline); border-radius: var(--radius); background: rgba(255,255,255,.02); box-shadow: var(--shadow); }
    .contact-product{ overflow:hidden; }
    .contact-product .product-body{ padding: 16px; display:grid; gap:8px; }
    .badge{ display:inline-block; padding:.25rem .6rem; border-radius:999px; border:1px solid rgba(207,162,58,.4); color:var(--text); }
    .contact-form-card{ padding: 16px; }
    .card-subtitle{ color:var(--muted); margin:0 0 8px; }
    .field{ display:grid; gap:6px; margin: 10px 0; }
    label{ color: var(--muted); }
    input, textarea{ width:100%; border-radius: 12px; border: 1px solid rgba(255,255,255,.12); background: #1a1214; color: var(--text); padding: .7rem .8rem; }
    input:focus-visible, textarea:focus-visible{ outline: 3px solid var(--ring); border-color: var(--accent); }
    .form-note{ color:var(--muted); font-size:.9em; margin:.5rem 0 0; }
    .contact-direct{ margin-top: 12px; color: var(--muted); }
    .contact-direct a{ color: var(--text); }
    @media (min-width: 960px){ .contact-layout{ grid-template-columns: 1.2fr .8fr; align-items:start; } }

    /* View toggling */
    [hidden]{ display:none !important; }

    /* ---------- Carousel ---------- */
.carousel{
  position: relative;
  background:#1a1414;
  border-bottom: var(--hairline);
}

.carousel-track{
  display:flex;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
  scroll-behavior:smooth;
  -ms-overflow-style: none;
  scrollbar-width: none;
}
.carousel-track::-webkit-scrollbar{ display:none; }

/* Make each direct child (anchor or img) a full-width slide & snap target */
.carousel-track > *{
  flex: 0 0 100%;
  scroll-snap-align: center;
}

/* The image itself fills the slide */
.carousel-slide{
  width:100%;
  height:100%;
  aspect-ratio: 4/3;
  object-fit:cover;
  display:block;
}

/* Ensure the anchor wrapper behaves like a block slide */
.slide-link{ display:block; height:100%; }

/* Nav buttons & dots unchanged */
.carousel-btn{
  position:absolute;
  top:50%;
  transform: translateY(-50%);
  width:36px; height:36px;
  border-radius:50%;
  border:1px solid var(--accent);
  background: rgba(0,0,0,.35);
  color:var(--text);
  display:grid; place-items:center;
  cursor:pointer;
  transition: background .2s ease, transform .2s ease;
}
.carousel-btn:hover{ background: rgba(0,0,0,.55); }
.carousel-btn:active{ transform: translateY(-50%) scale(.96); }
.carousel-btn:focus-visible{ outline:3px solid var(--ring); outline-offset:2px; }
.carousel-btn.prev{ left:8px; }
.carousel-btn.next{ right:8px; }

.carousel-dots{
  position:absolute;
  left:50%; bottom:8px;
  transform: translateX(-50%);
  display:flex; gap:6px;
  padding:4px 8px;
  background: rgba(0,0,0,.25);
  border-radius: 999px;
  border: 1px solid rgba(207,162,58,.25);
  backdrop-filter: blur(4px);
}
.carousel-dots .dot{
  width:8px; height:8px; border-radius:50%;
  border: 1px solid var(--accent);
  background: rgba(207,162,58,.18);
  padding:0;
  display:block;
  cursor:pointer;
}
.carousel-dots .dot.active{ background: var(--accent); }
.carousel-dots .dot:focus-visible{ outline:2px solid var(--ring); outline-offset:2px; }

  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a href="#" class="brand" id="brandLink">
        <img src="assets/images/logo.png" alt="" style="width:100px; height:100px; object-fit:cover;" aria-hidden="true" />
        <span class="brand-text">Lotus Collections</span>
      </a>
      <nav aria-label="Primary">
        <ul class="nav">
          <li><a href="#catalogue" id="navCatalogue">Catalogue</a></li>
          <li><a href="#contact" id="navContact">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- CATALOGUE VIEW -->
  <section id="catalogue-view" aria-labelledby="catalogueHeading">
    <section class="hero">
      <div class="container hero-inner">
        <h1 id="catalogueHeading">Indian Luxury, Simplified.</h1>
        <p>Hand-picked sarees, lehengas, sherwanis & more. Click an item to enquire—our team will reach out shortly.</p>
      </div>
    </section>

    <section class="filters" aria-labelledby="filters-heading">
      <div class="container">
        <h2 class="visually-hidden" id="filters-heading">Filter by category</h2>
        <div class="filter-row">
          <button class="chip chip--active" data-filter="all" type="button">All</button>
          <button class="chip" data-filter="Saree" type="button">Sarees</button>
          <button class="chip" data-filter="Lehenga" type="button">Lehengas</button>
          <button class="chip" data-filter="Sherwani" type="button">Sherwanis</button>
          <button class="chip" data-filter="Kurta" type="button">Kurtas</button>
          <button class="chip" data-filter="Kids" type="button">Kids</button>
          <button class="chip" data-filter="Dupatta" type="button">Dupattas</button>
        </div>
      </div>
    </section>

    <main class="container" id="catalogue" tabindex="-1">
      <div id="product-grid" class="grid"></div>
    </main>
  </section>

  <!-- CONTACT VIEW -->
  <section id="contact-view" hidden>
    <main class="container contact-layout">
      <article class="contact-product" id="contact-product"></article>

      <aside class="contact-form-card">
        <h1 class="card-title">Enquire</h1>
        <p class="card-subtitle">Fill this out and we’ll contact you shortly.</p>
        <form id="enquiry-form" novalidate>
          <div class="field">
            <label for="name">Full Name</label>
            <input id="name" name="name" type="text" required autocomplete="name" />
          </div>
          <div class="field">
            <label for="email">Email</label>
            <input id="email" name="email" type="email" required autocomplete="email" />
          </div>
          <div class="field">
            <label for="phone">Phone (optional)</label>
            <input id="phone" name="phone" type="tel" inputmode="tel" autocomplete="tel" />
          </div>
          <div class="field">
            <label for="message">Message</label>
            <textarea id="message" name="message" rows="4" placeholder="Sizing, colour, delivery…"></textarea>
          </div>
          <input type="hidden" id="productId" name="productId" />
          <button class="btn btn--primary" type="submit">Send Enquiry</button>
          <p class="form-note">This opens your email app—no payments here.</p>
        </form>
        <div class="contact-direct">
          <p><strong>Prefer direct contact?</strong></p>
          <p>Email: <a id="storeEmail" href="mailto:info@yourstore.com">info@yourstore.com</a></p>
          <p>Phone: <a id="storePhone" href="tel:+61123456789">+61 123 456 789</a></p>
          <p><a class="link" href="#catalogue">← Back to catalogue</a></p>
        </div>
      </aside>
    </main>
  </section>

  <footer class="site-footer">
    <div class="container footer-inner">
      <p>© <span id="year"></span> Lotus Collections. Handcrafted Luxury.</p>
      <small>No payments are processed on this website. Enquiries only.</small>
    </div>
  </footer>

  <script>
    // ---------- Data (PNG paths) ----------
    // Replace the sample paths below with your actual PNG locations.
    // You can provide either:
    //   A) images: ["/assets/.../1.png", "/assets/.../2.png", ...]
    //   B) image: "/assets/.../main.png"  (falls back to a single-slide carousel)
    // Bug fix image name mismatch 16 sept.

    window.PRODUCTS = [
      {
        id: "Yellow-fade-kurta",
        name: "Yellow Faded Kurta",
        category: "Kurta",
        fabric: "Cotton",
        color: "Yellow/White",
        priceRange: "$$$",
        images: [
          "/assets/images/yellow fade kurta.jpeg",
          "/assets/images/yellow fade kurta 2.jpeg"
        ],
        blurb: "TBD"
      },
      {
        id: "black-kurta",
        name: "Black Shimmer Kurta",
        category: "Kurta",
        fabric: "Cotton",
        color: "Black",
        priceRange: "$$$",
        images: [
          "/assets/images/black kurta.jpeg",
          "/assets/images/black kurta 2.jpeg"
        ],
        blurb: "TBD"
      },
      {
        id: "blue-kurta",
        name: "Blue Kurta",
        category: "Kurta",
        fabric: "Silk",
        color: "Blue",
        priceRange: "$$$",
        images: [
          "/assets/images/blue kurta.jpeg",
          "/assets/images/blue kurta 2.jpeg"
        ],
        blurb: "TBD"
      },
      {
        id: "purple-silk",
        name: "Purple Silk Kurta",
        category: "Kurta",
        fabric: "Silk",
        color: "Purple",
        priceRange: "$$$",
        images: [
          "/assets/images/purple silk kurta.jpeg",
          "/assets/images/purple silk kurta 2.jpeg"
        ],
        blurb: "TBD"
      },
      {
        id: "black-and-red-lehenga",
        name: "Black and Red Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "Black/Red",
        priceRange: "$$$",
        images: [
          "/assets/images/black and red lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "blue-and-vermilion-lehenga",
        name: "Blue and Vermillion Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/blue and vermilion lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "burgundy-lehenga",
        name: "Burgundy Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/burgundy lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "cyan-maroon-lehenga",
        name: "Cyan and Maroon Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/Cyan maroon lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "deep-sea-blue-lehenga",
        name: "Deep Sea Blue Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/deep sea blue lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "ivory-lehenga",
        name: "Ivory Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/Ivory Lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "maroon-lehenga",
        name: "Maroon Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/Maroon lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "orange-lehenga",
        name: "Orange Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/orange lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "pink-and-blue-lehenga",
        name: "Pink and Blue Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/pink and blue lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "pink-and-ivory-lehenga",
        name: "Pink and Ivory Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/pink and ivory lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "pink-lehenga",
        name: "Pink Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/Pink lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "purple-and-ivory-lehenga",
        name: "Purple and Ivory Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/purple and ivory lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "purple-and-light-green lehenga",
        name: "Purple and Light Green Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/purple and light green lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "purple-and-seagreen-lehenga",
        name: "Purple and Sea Green Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/purple and sea green lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "purple-lehenga",
        name: "Purple Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/purple lehenga.jpeg",
        ],
        blurb: "TBD"
      },
      {
        id: "white-and-red-lehenga",
        name: "White and Red Lehenga",
        category: "Lehenga",
        fabric: "",
        color: "",
        priceRange: "$$$",
        images: [
          "/assets/images/white nad red lehenga.jpeg",
        ],
        blurb: "TBD"
      },
    ];

    window.STORE = { email: "Lotus.collections2025@gmail.com", phone: "+61 416 708 128", GAS_URL: "https://script.google.com/macros/s/AKfycby4RBGMI3WbPCly1KEWnAyOdJQUl5qKKxT7x8My8eKY67JtZJ6W2J8HWw8GnVOa_6v9Vg/exec", GAS_SECRET: "replace-with-a-random-long-string" };

    // ---------- Utilities ----------
    const el = sel => document.querySelector(sel);
    const els = sel => Array.from(document.querySelectorAll(sel));
    function setYear(){ const y = el('#year'); if (y) y.textContent = new Date().getFullYear(); }

    function getImages(p){
      if (Array.isArray(p.images) && p.images.length) return p.images;
      if (typeof p.image === 'string' && p.image) return [p.image];
      // last-resort 1x1 transparent gif
      return ['data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=='];
    }

    // ---------- Carousel Template ----------
    function carouselTemplate(p){
      const url = `?product=${encodeURIComponent(p.id)}`;
      return `
        <div class="carousel" role="group" aria-roledescription="carousel" aria-label="${p.name} images">
          <div class="carousel-track">
            ${getImages(p).map((src, idx) =>
              `<a href="${url}" data-product="${p.id}" aria-label="Enquire about ${p.name}" class="slide-link">
                 <img class="carousel-slide" src="${src}" alt="${p.name} — image ${idx+1}" loading="lazy" />
               </a>`
            ).join('')}
          </div>
          <button class="carousel-btn prev" type="button" aria-label="Previous image">‹</button>
          <button class="carousel-btn next" type="button" aria-label="Next image">›</button>
          <div class="carousel-dots" aria-hidden="true"></div>
        </div>
      `;
    }

    // ---------- Catalogue rendering ----------
    function cardTemplate(p){
      return `
        <article class="card" data-category="${p.category}">
          ${carouselTemplate(p)}
          <div class="card-body">
            <h3 class="card-title">${p.name}</h3>
            <div class="card-meta">${p.category} • ${p.fabric} • ${p.color}</div>
            <div class="card-cta">
              <span class="card-meta">Range: ${p.priceRange}</span>
              <a class="btn" href="?product=${encodeURIComponent(p.id)}" data-product="${p.id}">Enquire</a>
            </div>
          </div>
        </article>`;
    }

    function renderGrid(list){
      const grid = el('#product-grid');
      if (!grid) return;
      grid.innerHTML = list.map(cardTemplate).join('');
      setupCarousels(); // init carousels after rendering
    }

    function applyFilter(category){
      if (category === 'all') return renderGrid(window.PRODUCTS);
      renderGrid(window.PRODUCTS.filter(p => p.category === category));
    }

    function setupFilters(){
      els('.chip').forEach(chip => {
        chip.addEventListener('click', () => {
          el('.chip--active')?.classList.remove('chip--active');
          chip.classList.add('chip--active');
          applyFilter(chip.dataset.filter);
        });
      });
    }

    // ---------- Carousel logic ----------
    function setupCarousels(){
      els('.carousel').forEach(initCarousel);
    }

    function initCarousel(root){
      const track = root.querySelector('.carousel-track');
      const prev  = root.querySelector('.carousel-btn.prev');
      const next  = root.querySelector('.carousel-btn.next');
      const dots  = root.querySelector('.carousel-dots');
      const slides = Array.from(track.children); // links (catalogue) or imgs (contact)

      let index = 0;

      // Build dots
      if (dots){
        dots.innerHTML = slides.map(() => `<button class="dot" type="button" aria-label="Go to image"></button>`).join('');
      }

      function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

      function scrollToIndex(i, smooth = true){
        index = clamp(i, 0, slides.length - 1);
        const w = track.clientWidth || 1;
        track.scrollTo({ left: index * w, behavior: smooth ? 'smooth' : 'auto' });
        updateDots();
        updateButtons();
      }

      function updateDots(){
        if (!dots) return;
        const dotEls = Array.from(dots.children);
        dotEls.forEach((d, i) => d.classList.toggle('active', i === index));
      }

      function updateButtons(){
        if (!prev || !next) return;
        prev.disabled = (index === 0);
        next.disabled = (index === slides.length - 1);
        prev.setAttribute('aria-disabled', prev.disabled);
        next.setAttribute('aria-disabled', next.disabled);
      }

      prev?.addEventListener('click', (e)=>{ e.preventDefault(); e.stopPropagation(); scrollToIndex(index - 1); });
      next?.addEventListener('click', (e)=>{ e.preventDefault(); e.stopPropagation(); scrollToIndex(index + 1); });

      dots?.addEventListener('click', (e) => {
        const btn = e.target.closest('.dot');
        if (!btn) return;
        const i = Array.from(dots.children).indexOf(btn);
        scrollToIndex(i);
        e.stopPropagation();
      });

      // Sync index on scroll (touch/mouse drag)
      let t;
      track.addEventListener('scroll', () => {
        clearTimeout(t);
        t = setTimeout(() => {
          const w = track.clientWidth || 1;
          index = Math.round(track.scrollLeft / w);
          updateDots();
          updateButtons();
        }, 80);
      }, { passive: true });

      const ro = new ResizeObserver(() => scrollToIndex(index, false));
      ro.observe(track);

      scrollToIndex(0, false);
    }

    // ---------- Routing (simple) ----------
    function setURL(url, { replace = false } = {}) {
      const fn = replace ? 'replaceState' : 'pushState';
      history[fn]({}, '', url);
    }
    function getProductById(id){ return window.PRODUCTS.find(p => p.id === id); }

    function showCatalogue({ replace = false } = {}) {
      el('#catalogue-view').hidden = false;
      el('#contact-view').hidden = true;

      const cleanURL = location.pathname + location.hash;
      if (location.search || replace) setURL(cleanURL, { replace });

      el('#navCatalogue')?.classList.add('active');
      el('#navContact')?.classList.remove('active');
    }

    function productCarouselOnly(p){
      return `
        <div class="carousel" role="group" aria-roledescription="carousel" aria-label="${p.name} images">
          <div class="carousel-track">
            ${getImages(p).map((src, idx) => `
              <img class="carousel-slide" src="${src}" alt="${p.name} — image ${idx+1}" loading="lazy" />
            `).join('')}
          </div>
          <button class="carousel-btn prev" type="button" aria-label="Previous image">‹</button>
          <button class="carousel-btn next" type="button" aria-label="Next image">›</button>
          <div class="carousel-dots" aria-hidden="true"></div>
        </div>`;
    }

    function showContact(productId, { replace = false } = {}) {
      const product = getProductById(productId);
      const productEl = el('#contact-product');
      const emailLink = el('#storeEmail');
      const phoneLink = el('#storePhone');
      if (emailLink) { emailLink.href = `mailto:${window.STORE.email}`; emailLink.textContent = window.STORE.email; }
      if (phoneLink) { phoneLink.href = `tel:${window.STORE.phone.replace(/\s+/g, '')}`; phoneLink.textContent = window.STORE.phone; }

      if (product){
        productEl.innerHTML = `
          ${productCarouselOnly(product)}
          <div class="product-body">
            <span class="badge">${product.category}</span>
            <h1 class="card-title" style="margin-top:.3rem">${product.name}</h1>
            <p class="card-subtitle">${product.blurb || ''}</p>
            <p class="card-meta">Fabric: ${product.fabric} • Colour: ${product.color} • Range: ${product.priceRange}</p>
          </div>`;
        const hiddenId = el('#productId'); if (hiddenId) hiddenId.value = product.id;

        const contactCarousel = productEl.querySelector('.carousel');
        if (contactCarousel) initCarousel(contactCarousel);
      } else {
        productEl.innerHTML = `
          <div class="product-body">
            <h1 class="card-title">Item Not Found</h1>
            <p class="card-subtitle">Please return to the <a class="link" href="#catalogue">catalogue</a>.</p>
          </div>`;
      }

      el('#catalogue-view').hidden = true;
      el('#contact-view').hidden = false;
      el('#navCatalogue')?.classList.remove('active');
      el('#navContact')?.classList.add('active');

      const url = `?product=${encodeURIComponent(productId)}`;
      if (location.search !== url || replace) setURL(url, { replace });
    }

    function handleInitialRoute(){
      const params = new URLSearchParams(location.search);
      const pid = params.get('product');
      if (pid) {
        showContact(pid, { replace: true });
      } else {
        showCatalogue({ replace: true });
      }
    }

    function setupGridClicks(){
      const grid = el('#product-grid');
      grid.addEventListener('click', (e) => {
        const target = e.target.closest('[data-product]');
        if (!target) return;
        e.preventDefault();
        const pid = target.getAttribute('data-product');
        showContact(pid);
      });
    }

    function setupNav(){
      el('#brandLink')?.addEventListener('click', (e) => { e.preventDefault(); showCatalogue(); });
      el('#navCatalogue')?.addEventListener('click', (e) => { e.preventDefault(); showCatalogue(); });
      el('#navContact')?.addEventListener('click', (e) => {
        e.preventDefault();
        const hiddenId = el('#productId')?.value || window.PRODUCTS[0]?.id;
        showContact(hiddenId);
      });
      window.addEventListener('popstate', handleInitialRoute);
    }

    // ---------- Enquiry form (mailto) ----------
    // ---------- Enquiry form -> Google Sheet ----------
    function setupForm(){
    const form = document.querySelector('#enquiry-form');
    if (!form) return;

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const params  = new URLSearchParams(location.search);
        const pid     = params.get('product') || document.querySelector('#productId')?.value || '';
        const product = window.PRODUCTS?.find(p => p.id === pid);

        const payload = {
        secret:     window.STORE?.GAS_SECRET || '',
        productId:  product?.id || pid || '(unknown)',
        name:       document.querySelector('#name')?.value.trim()   || '',
        email:      document.querySelector('#email')?.value.trim()  || '',
        phone:      document.querySelector('#phone')?.value.trim()  || '',
        message:    document.querySelector('#message')?.value.trim()|| '',
        pageUrl:    location.href,
        userAgent:  navigator.userAgent
        };

        // Optional: basic front-end validation
        if (!payload.name || !payload.email){
        alert('Please enter your name and email.'); return;
        }

        // Show a tiny "sending..." state
        const btn = form.querySelector('button[type="submit"]');
        const original = btn.textContent;
        btn.disabled = true; btn.textContent = 'Sending…';

        try {
        // POST JSON. Using `no-cors` avoids CORS preflight,
        // and Apps Script will still receive and write the row.
        await fetch(window.STORE.GAS_URL, {
            method: 'POST',
            mode: 'no-cors', // prevents CORS errors; response will be opaque
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        // Clear + thank you
        form.reset();
        alert('Thanks! Your enquiry has been received. We’ll contact you shortly.');

        } catch (err) {
        console.error(err);
        alert('Sorry—something went wrong. Please try again.');
        } finally {
        btn.disabled = false; btn.textContent = original;
        }
    });
    }


    // ---------- Init ----------
    (function init(){
      setYear();
      renderGrid(window.PRODUCTS);
      setupFilters();
      setupGridClicks();
      setupNav();
      setupForm();
      handleInitialRoute();
    })();
  </script>
</body>
</html>
